<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Olimp√≠ada Equipes Sigma de Matem√°tica</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css"/>
</head>
<body>

<div class="wrapper">
  <header>
    <div class="sigma-badge">Inscri√ß√µes Abertas</div>
    <h1>Olimp√≠ada Equipes<br><span>Sigma</span> de Matem√°tica</h1>
    <p>Preencha os dados da sua equipe com aten√ß√£o. Todos os campos s√£o obrigat√≥rios.</p>
  </header>

  <form id="sigma-form" novalidate>

    <!-- Team size selector -->
    <div class="card">
      <div class="section-title">Tamanho da Equipe</div>
      <div class="team-selector">
        <label class="team-option">
          <input type="radio" name="team-size" value="2" id="size-2">
          <div class="team-option-label">
            <span class="team-num">2</span>
            <span class="team-label-text">Participantes</span>
          </div>
        </label>
        <label class="team-option">
          <input type="radio" name="team-size" value="3" id="size-3" checked>
          <div class="team-option-label">
            <span class="team-num">3</span>
            <span class="team-label-text">Participantes</span>
          </div>
        </label>
      </div>

      <!-- General team data -->
      <div class="section-title">Dados da Equipe</div>
      <div style="display:flex;flex-direction:column;gap:16px;">
        <div class="field-group">
          <div class="field">
            <label for="team-name">Nome da Equipe</label>
            <input type="text" id="team-name" name="team-name" placeholder="Ex: Gauss Warriors">
            <span class="field-error" id="err-team-name"></span>
          </div>
          <div class="field">
            <label for="team-level">N√≠vel de Participa√ß√£o</label>
            <select id="team-level" name="team-level">
              <option value="">Selecione...</option>
              <option value="Alpha">Alpha</option>
              <option value="Beta">Beta</option>
              <option value="Gama">Gama</option>
            </select>
            <span class="field-error" id="err-team-level"></span>
          </div>
        </div>
        <div class="field-group">
          <div class="field">
            <label for="team-school">Escola</label>
            <input type="text" id="team-school" name="team-school" placeholder="Nome completo da escola">
            <span class="field-error" id="err-team-school"></span>
          </div>
          <div class="field">
            <label for="team-uf">Estado (UF)</label>
            <select id="team-uf" name="team-uf">
              <option value="">Selecione...</option>
              <option>AC</option><option>AL</option><option>AP</option><option>AM</option>
              <option>BA</option><option>CE</option><option>DF</option><option>ES</option>
              <option>GO</option><option>MA</option><option>MT</option><option>MS</option>
              <option>MG</option><option>PA</option><option>PB</option><option>PR</option>
              <option>PE</option><option>PI</option><option>RJ</option><option>RN</option>
              <option>RS</option><option>RO</option><option>RR</option><option>SC</option>
              <option>SP</option><option>SE</option><option>TO</option>
            </select>
            <span class="field-error" id="err-team-uf"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Participants container -->
    <div id="participants-container"></div>

    <div class="form-actions">
      <button type="button" class="btn-secondary" id="btn-reset">‚Ü∫ Limpar</button>
      <button type="submit" class="btn-primary">Confirmar Inscri√ß√£o ‚Üí</button>
    </div>
  </form>

  <!-- Result -->
  <div id="result-section">
    <div class="result-card">
      <div class="result-title">‚úì Inscri√ß√£o Gerada</div>
      <div class="result-subtitle">Confira os dados abaixo antes de enviar.</div>
      <pre id="json-output"></pre>
      <div class="result-actions">
        <button class="btn-primary" id="btn-download">‚Üì Baixar JSON</button>
        <button class="btn-secondary" id="btn-edit">‚Üê Editar</button>
      </div>
    </div>
  </div>
</div>

<script>
(function () {
  const form = document.getElementById('sigma-form');
  const container = document.getElementById('participants-container');
  const resultSection = document.getElementById('result-section');
  const jsonOutput = document.getElementById('json-output');

  let currentSize = 3;
  let fileData = {}; // { 'p0': { name, type }, ... }

  // Build participants
  function buildParticipants(count) {
    // Animate out existing cards
    const existing = container.querySelectorAll('.participant-card');
    existing.forEach(c => {
      c.style.transition = 'opacity 0.2s, transform 0.2s';
      c.style.opacity = '0';
      c.style.transform = 'translateY(-10px)';
    });

    setTimeout(() => {
      container.innerHTML = '';
      for (let i = 0; i < count; i++) {
        container.appendChild(createParticipantCard(i));
      }
      // Reattach file listeners
      container.querySelectorAll('input[type="file"]').forEach(input => {
        input.addEventListener('change', handleFileChange);
      });
    }, existing.length ? 200 : 0);
  }

  function createParticipantCard(index) {
    const isLeader = index === 0;
    const div = document.createElement('div');
    div.className = 'participant-card' + (isLeader ? ' leader' : '');
    div.id = 'card-p' + index;

    div.innerHTML = `
      <div class="participant-header">
        <div class="participant-num">${index + 1}</div>
        <div class="participant-title">Participante ${index + 1}</div>
        ${isLeader ? '<span class="leader-badge">‚òÖ L√≠der</span>' : ''}
      </div>
      <div style="display:flex;flex-direction:column;gap:16px;">
        <div class="field-group full">
          <div class="field">
            <label for="p${index}-name">Nome Completo</label>
            <input type="text" id="p${index}-name" name="p${index}-name" placeholder="Nome completo">
            <span class="field-error" id="err-p${index}-name"></span>
          </div>
        </div>
        <div class="field-group">
          <div class="field">
            <label for="p${index}-dob">Data de Nascimento</label>
            <input type="date" id="p${index}-dob" name="p${index}-dob" placeholder="data">
            <span class="field-error" id="err-p${index}-dob"></span>
          </div>
          <div class="field">
            <label for="p${index}-phone">Telefone com DDD</label>
            <input type="tel" id="p${index}-phone" name="p${index}-phone" placeholder="(11) 99999-9999" maxlength="15">
            <span class="field-error" id="err-p${index}-phone"></span>
          </div>
        </div>
        <div class="field-group full">
          <div class="field">
            <label for="p${index}-email">E-mail</label>
            <input type="email" id="p${index}-email" name="p${index}-email" placeholder="email@dominio.com">
            <span class="field-error" id="err-p${index}-email"></span>
          </div>
        </div>
        <div class="field-group full">
          <div class="field">
            <label>Comprovante de Escolaridade (PDF ou imagem)</label>
            <div class="file-upload">
              <input type="file" id="p${index}-file" name="p${index}-file" accept=".pdf,image/*" data-index="${index}">
              <label class="file-upload-label" for="p${index}-file" id="file-label-p${index}">
                <span class="file-icon">üìé</span>
                <span id="file-text-p${index}">Clique para selecionar arquivo</span>
              </label>
            </div>
            <span class="field-error" id="err-p${index}-file"></span>
          </div>
        </div>
      </div>
    `;

    // Phone mask
    const phoneInput = div.querySelector(`#p${index}-phone`);
    phoneInput.addEventListener('input', function () {
      let v = this.value.replace(/\D/g, '').slice(0, 11);
      if (v.length >= 7) {
        v = v.replace(/^(\d{2})(\d{4,5})(\d{0,4})$/, '($1) $2-$3');
      } else if (v.length >= 3) {
        v = v.replace(/^(\d{2})(\d+)$/, '($1) $2');
      }
      this.value = v;
    });

    return div;
  }

  function handleFileChange(e) {
    const index = e.target.dataset.index;
    const file = e.target.files[0];
    const label = document.getElementById('file-label-p' + index);
    const text = document.getElementById('file-text-p' + index);
    const err = document.getElementById('err-p' + index + '-file');

    if (file) {
      fileData['p' + index] = { name: file.name, type: file.type };
      label.classList.add('has-file');
      text.textContent = '‚úì ' + file.name;
      err.textContent = '';
      e.target.classList.remove('error');
    } else {
      delete fileData['p' + index];
      label.classList.remove('has-file');
      text.textContent = 'Clique para selecionar arquivo';
    }
  }

  // Radio change
  document.querySelectorAll('input[name="team-size"]').forEach(r => {
    r.addEventListener('change', function () {
      currentSize = parseInt(this.value);
      fileData = {};
      buildParticipants(currentSize);
    });
  });

  // Validation
  function setError(id, msg) {
    const el = document.getElementById('err-' + id);
    const input = document.getElementById(id);
    if (el) el.textContent = msg;
    if (input) {
      if (msg) input.classList.add('error');
      else input.classList.remove('error');
    }
    return !!msg;
  }

  function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function validatePhone(phone) {
    const digits = phone.replace(/\D/g, '');
    return digits.length >= 10 && digits.length <= 11;
  }

  function validateForm() {
    let hasError = false;

    // Team fields
    const teamName = document.getElementById('team-name').value.trim();
    const teamLevel = document.getElementById('team-level').value;
    const teamSchool = document.getElementById('team-school').value.trim();
    const teamUf = document.getElementById('team-uf').value;

    if (!teamName) hasError = setError('team-name', 'Informe o nome da equipe.') || hasError;
    else setError('team-name', '');
    if (!teamLevel) hasError = setError('team-level', 'Selecione o n√≠vel.') || hasError;
    else setError('team-level', '');
    if (!teamSchool) hasError = setError('team-school', 'Informe o nome da escola.') || hasError;
    else setError('team-school', '');
    if (!teamUf) hasError = setError('team-uf', 'Selecione o estado.') || hasError;
    else setError('team-uf', '');

    // Participants
    for (let i = 0; i < currentSize; i++) {
      const name = document.getElementById('p' + i + '-name').value.trim();
      const dob = document.getElementById('p' + i + '-dob').value;
      const phone = document.getElementById('p' + i + '-phone').value.trim();
      const email = document.getElementById('p' + i + '-email').value.trim();
      const file = document.getElementById('p' + i + '-file').files[0];

      if (!name) hasError = setError('p' + i + '-name', 'Informe o nome completo.') || hasError;
      else setError('p' + i + '-name', '');
      if (!dob) hasError = setError('p' + i + '-dob', 'Informe a data de nascimento.') || hasError;
      else setError('p' + i + '-dob', '');
      if (!phone || !validatePhone(phone)) hasError = setError('p' + i + '-phone', 'Informe um telefone v√°lido com DDD.') || hasError;
      else setError('p' + i + '-phone', '');
      if (!email || !validateEmail(email)) hasError = setError('p' + i + '-email', 'Informe um e-mail v√°lido.') || hasError;
      else setError('p' + i + '-email', '');
      if (!file) hasError = setError('p' + i + '-file', 'Anexe o comprovante de escolaridade.') || hasError;
      else setError('p' + i + '-file', '');
    }

    return !hasError;
  }

  function buildJSON() {
    const participants = [];
    for (let i = 0; i < currentSize; i++) {
      participants.push({
        numero: i + 1,
        lider: i === 0,
        nome: document.getElementById('p' + i + '-name').value.trim(),
        data_nascimento: document.getElementById('p' + i + '-dob').value,
        telefone: document.getElementById('p' + i + '-phone').value.trim(),
        email: document.getElementById('p' + i + '-email').value.trim(),
        comprovante: fileData['p' + i] ? fileData['p' + i].name : null
      });
    }

    return {
      equipe: {
        nome: document.getElementById('team-name').value.trim(),
        nivel: document.getElementById('team-level').value,
        escola: document.getElementById('team-school').value.trim(),
        estado_uf: document.getElementById('team-uf').value,
        total_participantes: currentSize
      },
      participantes: participants
    };
  }

  // Form submit
  form.addEventListener('submit', function (e) {
    e.preventDefault();
    if (!validateForm()) return;

    const data = buildJSON();
    jsonOutput.textContent = JSON.stringify(data, null, 2);
    resultSection.style.display = 'block';
    resultSection.scrollIntoView({ behavior: 'smooth' });
  });

  // Reset
  document.getElementById('btn-reset').addEventListener('click', function () {
    form.reset();
    fileData = {};
    resultSection.style.display = 'none';
    container.querySelectorAll('.file-upload-label').forEach(l => {
      l.classList.remove('has-file');
      const txt = l.querySelector('span:last-child');
      if (txt) txt.textContent = 'Clique para selecionar arquivo';
    });
    container.querySelectorAll('.field-error').forEach(e => e.textContent = '');
    container.querySelectorAll('input, select').forEach(i => i.classList.remove('error'));
    document.querySelectorAll('.field-error').forEach(e => e.textContent = '');
    document.querySelectorAll('input, select').forEach(i => i.classList.remove('error'));
  });

  // Download JSON
  document.getElementById('btn-download').addEventListener('click', function () {
    const data = buildJSON();
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'inscricao-sigma-' + Date.now() + '.json';
    a.click();
    URL.revokeObjectURL(a.href);
  });

  // Edit
  document.getElementById('btn-edit').addEventListener('click', function () {
    resultSection.style.display = 'none';
    form.scrollIntoView({ behavior: 'smooth' });
  });

  // Init
  buildParticipants(currentSize);
})();
</script>
</body>
</html>
